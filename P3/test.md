（本文不含实例代码，仅写了一点思路）

# 一次失败的尝试

最开始看到`自动评测`，我脑中第一个蹦出的想法是做一个能自测的评测脚本，然而理想很丰满，现实很骨感:cry:

丰满的理想：这是一个自动评测脚本，运行`MARS`传入自己写的asm汇编文件，导出HexText，添加`v2.0 raw`头，~~导入`logisim`~~并运行（保证提前写好`logisim`的测试电路文件），~~导出运行结束时的寄存器、内存快照~~；然后再用`MARS`运行asm汇编文件，导出运行结束时的寄存器、内存快照。将二者进行比对，输出评测结果。一整套流程一气呵成！

骨感的现实：读了`MARS`和`logisim`的帮助文档，发现**`logisim`在cli下不支持导入数据到`ROM`，也不支持导出运行结束时的寄存器、内存快照**！！！（关键是gui的logging偏偏可以，气）有那么一瞬间，想到`logisim`支持导入自定义的`Jar Library`组件库，觉得可以狠狠地**反射**`logisim`，让它把寄存器和内存状态吐出来:smiling_imp:。试读了一下`logisim`的源码。。。dbq做不到:hand::cry:，因为我太菜看不懂:sob:，如果有哪位助教gg会那求带:innocent:

# 回归本真

还是老老实实用一下gui吧。但仔细想想，既然都用上了gui，好像自动评测也没帮上多大忙？而且个人觉得P3写的数据生成器还不如自己写汇编来得更快更清晰。但是既然都交了文档了，那还是说一下做辅助评测的思路吧。先要准备：`logisim.jar`、`MARS.jar`、自己写的`asm`测试汇编代码、待测试的`circ`电路文件。

* 【自动】首先生成要填入`logisim`的`ROM`的数据，用以下命令：

  ```shell
  java -jar MARS.jar nc mc CompactDataAtZero a dump .text HexText hexcode.txt mips1.asm
  ```

  然后对生成的`hexcode.txt`文件追加`v2.0 raw`头部。

* 【手动】将`hexcode.txt`的手动导入`logisim`中，运行一段时间（按P3课下要求可以是32个时钟周期），手动导出`RAM`的数据快照。还可以手动保存一下寄存器快照（我只能想到截图）。

* 【自动】用`MARS`运行汇编代码并保存结束时内存快照：

    ```shell
    java -jar MARS.jar nc b mc CompactDataAtZero 0x00000000-0x0000007C mips1.asm > Mem.txt
    ```

    还可以输出寄存器快照（我觉得要【手动】比对。。）：
    
    ```shell
    java -jar MARS.jar nc mc CompactDataAtZero $0 $1 $2 $3 ...... $31 mips1.asm

* 【自动】读入`logisim`导出的内存快照和`MARS`导出的内存快照，但`logisim`的画风是这样的：

  ```
  v2.0 raw
  1ff 0 666 17*0 dddeee 0 0 ffffffff
  6*0
  ```

  ~~十分智能地~~合并了重复项、省略高位`0`并且去除了最后一段连续的`00000000`，所以要先去除头部`v2.0 raw`，然后展开一下合并项，再给字内高位补`0`，最后给尾部补上长度不足的`00000000`。而`MARS`的画风就好多了：

  ```
  0x00000064      0x00000000      0x00000000      0x00000000
  0x00000000      0x00000000      0x00000000      0x00000000
  0x00000000      0x00000000      0x00000000      0x00000000
  0x00000000      0x00000000      0x00000000      0x00000000
  0x00000000      0x00000000      0x00000000      0x00000000
  0x00000000      0x00000000      0x00000000      0x00000000
  0x00000000      0x00000000      0x00000000      0x00000000
  0x00000000      0x00000000      0x00000000      0x00000000
  ```

  完美的输出，从左到右，从上到下，只要去除前缀`0x`就可以拿来比较了。

以上就是辅助评测的大致流程，实现应该不难（，原谅我懒，摸了qwq
